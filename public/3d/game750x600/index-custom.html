<!DOCTYPE html>
<html>
    <head>
        <title>3D Рулетка</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="css/reset.css" type="text/css">
        <link rel="stylesheet" href="css/main.css" type="text/css">
        <link rel="stylesheet" href="css/orientation_utils.css" type="text/css">

        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, minimal-ui" />
	<meta name="msapplication-tap-highlight" content="no"/>

        <script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>
        <script type="text/javascript" src="js/createjs-2015.11.26.min.js"></script>
        <script type="text/javascript" src="js/howler.min.js"></script>
        <script type="text/javascript" src="js/screenfull.js"></script>
        <script type="text/javascript" src="js/ctl_utils.js"></script>
        <script type="text/javascript" src="js/sprite_lib.js"></script>
        <script type="text/javascript" src="js/settings.js"></script>
        <script type="text/javascript" src="js/CRouletteSettings.js"></script>
        <script type="text/javascript" src="js/CFichesController.js"></script>
        <script type="text/javascript" src="js/CLang.js"></script>
        <script type="text/javascript" src="js/CPreloader.js"></script>
        <script type="text/javascript" src="js/CMain.js"></script>
        <script type="text/javascript" src="js/CTextButton.js"></script>
        <script type="text/javascript" src="js/CGfxButton.js"></script>
        <script type="text/javascript" src="js/CFicheBut.js"></script>
        <script type="text/javascript" src="js/CBetTableButton.js"></script>
        <script type="text/javascript" src="js/CBetTextButton.js"></script>
        <script type="text/javascript" src="js/CToggle.js"></script>
        <script type="text/javascript" src="js/CMenu.js"></script>
        <script type="text/javascript" src="js/CGame.js"></script>
        <script type="text/javascript" src="js/CInterface.js"></script>
        <script type="text/javascript" src="js/CMsgBox.js"></script>
        <script type="text/javascript" src="js/CTweenController.js"></script>
        <script type="text/javascript" src="js/CSeat.js"></script>
        <script type="text/javascript" src="js/CTableController.js"></script>
        <script type="text/javascript" src="js/CEnlight.js"></script>
        <script type="text/javascript" src="js/CWheelTopAnim.js"></script>
        <script type="text/javascript" src="js/CFiche.js"></script>
        <script type="text/javascript" src="js/CHistoryRow.js"></script>
        <script type="text/javascript" src="js/CWheelAnim.js"></script>
        <script type="text/javascript" src="js/CFinalBetPanel.js"></script>
        <script type="text/javascript" src="js/CNeighborsPanel.js"></script>
        <script type="text/javascript" src="js/CGameOver.js"></script>
		<script type="text/javascript" src="js/CCreditsPanel.js"></script>
        
    </head>
    <body ondragstart="return false;" ondrop="return false;" style="margin: 0; padding: 0; overflow: hidden; background: transparent;">
	<style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: transparent;
        }
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
    </style>
	<div style="position: fixed; background-color: transparent; top: 0px; left: 0px; width: 100%; height: 100%"></div>
          <script>
            var customBalance = 100; // Default balance
            var oMainGame = null;
            var gameInitialized = false;
            
            // Listen for balance updates from parent
            window.addEventListener('message', function(event) {
                if (event.data.type === 'set_balance') {
                    customBalance = event.data.balance;
                    console.log('Received balance from parent:', customBalance);
                    
                    if (oMainGame && oMainGame._oInterface) {
                        oMainGame._oInterface.refreshMoney(customBalance);
                    } else if (oMainGame && oMainGame._oMySeat) {
                        oMainGame._oMySeat.setMoney(customBalance);
                    }
                } else if (event.data.type === 'add_balance') {
                    customBalance += event.data.amount;
                    if (oMainGame && oMainGame._oInterface) {
                        oMainGame._oInterface.refreshMoney(customBalance);
                    }
                }
            });
            
            // Request initial balance from parent
            window.parent.postMessage({ type: 'roulette_request_balance' }, '*');
            
            $(document).ready(function(){
                     // Wait a bit for balance to arrive
                     setTimeout(function() {
                         console.log('Starting game with balance:', customBalance);
                         oMainGame = new CMain({
                                                money: customBalance,
                                            min_bet: 1,
                                            max_bet: 100,
                                            time_bet: 0,
                                            time_winner: 3000,
                                            win_occurrence: -1,
                                            casino_cash: 10000,
                                            fullscreen: false,
                                            check_orientation: false,
											show_credits: false,
                                            num_hand_before_ads: 999999
                                });

                     
                     $(oMainGame).on("recharge", function(evt) {
                             window.parent.postMessage({ type: 'roulette_recharge' }, '*');
                     });
                     
                     $(oMainGame).on("start_session", function(evt) {
                            window.parent.postMessage({ type: 'roulette_start' }, '*');
                     });
                     
                    $(oMainGame).on("end_session", function(evt) {
                            window.parent.postMessage({ type: 'roulette_end' }, '*');
                    });
                     
					$(oMainGame).on("bet_placed", function (evt, iTotBet) {
                        window.parent.postMessage({ 
                            type: 'roulette_bet', 
                            amount: iTotBet 
                        }, '*');
                    });
					
                    $(oMainGame).on("save_score", function(evt, iMoney, iWin) {
                        window.parent.postMessage({ 
                            type: 'roulette_balance_update',
                            balance: iMoney,
                            win: iWin
                        }, '*');
                        
                        if (iWin > 0) {
                            window.parent.postMessage({ 
                                type: 'roulette_win', 
                                amount: iWin 
                            }, '*');
                        }
                    });
                     
                         if(isIOS()){
                             setTimeout(function(){sizeHandler();},200);
                         }else{
                             sizeHandler();
                         }
                     }, 500); // Wait 500ms for balance
           });

        </script>
        
        <div class="check-fonts">
            <p class="check-font-1">test 1</p>
            <p class="check-font-2">test 2</p>
        </div> 
        
        <canvas id="canvas" class='ani_hack' width="750" height="600"> </canvas>
        <div data-orientation="landscape" class="orientation-msg-container"><p class="orientation-msg-text">Будь ласка, поверніть пристрій</p></div>
        <div id="block_game" style="position: fixed; background-color: transparent; top: 0px; left: 0px; width: 100%; height: 100%; display:none"></div>
    </body>
</html>
